# Flutter应用详细分析

## 应用概述

"爪步"(Claw Step)是一个电子宠物陪伴旅游应用，通过AI虚拟宠物，将用户的日常步数转化为沉浸式全球旅行体验的情感疗愈应用。

## 技术栈

- **框架**: Flutter
- **语言**: Dart
- **国际化**: flutter_localizations + intl
- **状态管理**: setState
- **导航**: Navigator
- **UI组件**: Material Design
- **图片处理**: Image.asset, image_picker
- **权限管理**: permission_handler
- **本地存储**: shared_preferences
- **富文本渲染**: flutter_html
- **步数监听**: pedometer
- **视频播放**: video_player
- **网络请求**: http
- **剪贴板操作**: flutter/services (Clipboard)

## 应用架构

### 主入口 (main.dart)
- 应用启动和路由配置
- 国际化支持（中英文）
- 固定文本缩放因子
- 全局主题设置

### 页面结构
```
登录系统 → 宠物选择 → 主页
```

## 核心功能分析

### 1. 登录系统

#### 主登录页面 (login_page.dart)
- 4种登录方式：Google、Apple、邮箱、海外邮箱
- 白色背景，简洁设计
- 支持国际化

#### 邮箱登录页面 (email_login_page.dart)
- 邮箱和密码登录/注册
- 动态按钮颜色变化
- 忘记密码链接

#### 国内登录页面 (domestic_login_page.dart)
- 一键登录功能
- 第三方登录（抖音、苹果）
- 用户协议选择

#### 手机号登录页面 (phone_login_page.dart)
- 手机号验证码登录
- 60秒倒计时功能
- 协议弹窗确认

#### 忘记密码流程
- 忘记密码页面 → 验证码页面 → 新密码页面
- 6位数字验证码输入
- 实时密码匹配验证

### 2. 宠物选择系统 (pet_selection_page.dart)

#### 4个电子宠物
1. **艾迪 (Eddie)**: 爱薅羊毛，毒舌点评
2. **皮克 (Pik)**: 恶作剧爱好者
3. **乌迪斯 (Udis)**: 肌肉发达，热爱文学
4. **巴布 (Babu)**: 内心摇滚歌手

#### 多屏流程
1. 选择宠物（轮播图展示）
2. 输入昵称
3. 选择目的地（成都、东京、纽约、巴黎）
4. 步数权限请求

### 3. 主页面系统 (home_page.dart)

#### 3个Tab页面
- **旅行Tab**: 地图功能（占位符）
- **来信Tab**: 信件列表页面
- **对话Tab**: 漫游页面

#### 步数显示
- 显示当前步数和目标步数
- 进度条和脚印图标
- 圆角卡片设计

#### Tab导航
- PNG图标支持
- 选中放大效果（1.8倍）
- 平滑动画过渡

### 4. 来信系统 (letter_tab.dart)

#### 信件列表
- 垂直滚动列表
- 信件卡片设计（白色背景，圆角16px）
- 卡片阴影效果
- 未读标记（红色圆点）

#### 信件类型
- AI绘画信件
- AI歌曲信件
- AI看星盘信件

#### 信件详情 (letter_detail_page.dart)
- 聊天式消息布局
- AI和用户消息气泡
- 媒体展示支持（图片、视频）
- 交互按钮和AI功能触发

### 5. 对话系统 (voice_chat_page.dart)

#### 多模态聊天
- 文字对话
- 图片分享
- 语音聊天

#### 输入模式
- **文本模式**: 相机按钮 + 文本输入框 + 麦克风按钮
- **语音模式**: 橙色大圆形按钮 + 取消按钮
- **录音中**: 音波动画效果

#### AI回复逻辑
- 纯文字：回显用户消息
- 纯图片：回复"哇，这张照片很棒！"
- 图片+文字：回复"看到你的照片和消息啦！"
- 语音消息：回复"收到你的语音消息了！"

### 6. 双人旅行系统 (two_person_travel_page.dart)

#### 邀请功能
- 生成8位邀请码
- 7天有效期
- 复制到剪贴板功能

#### 接受邀请
- 输入邀请码验证
- 错误处理（不存在、已使用、已过期）
- 成功状态切换

#### 旅伴管理
- 解绑/取消解绑功能
- 24小时倒计时
- 解除后果提示

### 7. 用户管理系统

#### 个人主页 (profile_page.dart)
- 用户信息展示
- 功能入口列表
- Pro版本宣传卡片

#### Pro订阅页面 (pro_subscription_page.dart)
- 年费/月费选择
- 特权列表展示
- 用户评价区域

#### 旅伴档案页面 (pet_profile_page.dart)
- 宠物详细信息
- 旅行统计
- 梦想进度
- 成就系统

#### 步数统计页面 (step_statistics_page.dart)
- 各城市步数统计
- 汇总数据展示
- 城市列表展示

#### 优惠券管理 (my_coupons_page.dart)
- 优惠券列表
- 使用功能
- 空状态处理

#### 语言切换 (language_switch_page.dart)
- 10种语言支持
- 本地存储
- 确认对话框

#### 设置中心 (settings_page.dart)
- 功能设置
- 信息/法律相关
- 退出登录功能

#### 意见反馈 (feedback_page.dart)
- 文本输入
- 图片上传
- 联系方式填写

## API服务分析

### TwoPersonTravelService
- **generateInvitationCode()**: 生成邀请码
- **validateInvitationCode()**: 验证邀请码
- **acceptInvitation()**: 接受邀请
- **getInvitationRecords()**: 获取邀请记录
- **unbindPartner()**: 解除旅伴关系
- **cancelUnbind()**: 取消解除旅伴关系

### HealthService
- **checkHealthPermission()**: 检查健康权限
- **requestHealthPermission()**: 请求健康权限
- **getCurrentSteps()**: 获取当前步数

## 国际化支持

### 支持语言
- 中文（简体）
- 英文

### 文本键值
- 150+个国际化键值
- 涵盖所有页面和功能
- 动态切换支持

### 关键文本
- 应用标题、登录按钮、宠物信息
- 双人旅行相关文本
- 错误提示和成功消息

## 设计规范

### 颜色方案
- 主色调: #FF5900 (橙色)
- 辅助色: #6B73FF (蓝色)
- 背景色: 白色
- 文字色: Colors.black87

### 按钮样式
- 高度: 56px
- 圆角: 16px
- 字体: 16px, FontWeight.w600

### 输入框样式
- 高度: 56px
- 圆角: 16px
- 背景: Colors.grey.shade50

## 用户体验流程

1. **主登录页面** → 选择登录方式
2. **邮箱登录** → 输入邮箱密码 → 主页
3. **国内登录** → 一键登录 → 主页
4. **忘记密码流程**: 忘记密码页面 → 验证码页面 → 新密码页面
5. **宠物选择** → 输入昵称 → 选择目的地 → 步数权限 → 主页

## 技术特点

- **响应式设计**: 适配不同屏幕尺寸
- **状态管理**: 使用setState进行状态管理
- **表单验证**: 实时验证和错误提示
- **加载状态**: 所有异步操作都有加载动画
- **错误处理**: 完善的错误提示和用户反馈
- **导航管理**: 清晰的页面跳转逻辑
- **跨平台支持**: Web和移动端适配
